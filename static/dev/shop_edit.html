<!DOCTYPE html>
<html lang="en">
	<!-- container-fluid -->
	<head>
		<title>Unicorn Admin</title>
		<meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--公用样式-->
		<link rel="stylesheet" href="../public/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../public/css/bootstrap-responsive.min.css" />	
		<link rel="stylesheet" href="../public/css/unicorn.main.css" />
		<link rel="stylesheet" href="../public/css/unicorn.grey.css" />
		<!--页面样式-->
		<link href="../public/kindeditor/themes/default/default.css" type="text/css" rel="stylesheet">
	</head>
	<body>
		<!--top.html-->
		<div id="header"></div>
		<!--sidebar.html-->
		<div id="sidebar"></div>
		
		<div id="content">

			<div class="widget-box" >
				<div class="widget-title">
					<span class="icon">
						<i class="icon-gift"></i>
					</span>
					<h5>新增商户</h5>
				</div>
				<div class="widget-content">
					<form action="#" method="post" class="form-horizontal" id="j-goods-addForm" />
						<div class="widget-box" >
							<div class="widget-content">
								<div class="control-group">
									<label class="control-label">商户名称</label>
									<div class="controls">
										<input type="text" id="j-shop-name" />
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">登陆用户名</label>
									<div class="controls">
										<input type="text" id="j-login-name" />
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">商户logo</label>
									<div class="controls">
										
										<a class="btn btn-info" href="javascript:;" id="j-btn-imageUpload"><i class="icon-folder-open icon-white"></i> 本地上传</a>
										<a class="btn btn-success" href="javascript:;" id="j-btn-imageManager"><i class="icon-picture icon-white"></i> 素材库选择</a>
										<span class="help-inline">上传过的图片可以直接从素材库选择</span>
										<div class="clearfix" style="margin-top:10px;">
											<span class="thumbnail pull-left">
												<img src="http://placehold.it/128x128" alt="" id="j-img-placehold">
											</span>
										</div>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">商户类型</label>
									<div class="controls">
										<select id="j-subCategory-list"></select><span id="j-shop-category-hold" style="display:none;"><span style="padding:0 20px;">所属</span><span class="text-warning" id="j-shop-category">餐饮超市类</span></span>
									</div>
								</div>

								<div class="control-group" style="display:none;" id="j-template-hold">
									<label class="control-label">使用UI模版</label>
									<div class="controls">
										<select id="j-template-list"></select>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">入驻日期</label>
									<div class="controls">
										<span class="static-text">2014-02-12</span>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">服务期至</label>
									<div class="controls">
										<span class="static-text">2014-02-12</span>
										<a href="" class="btn btn-primary btn-mini"><i class="icon-plus icon-white"></i> 增加一年</a>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">是否使用【易wifi】</label>
									<div class="controls">
										<label class="checkbox"><input type="checkbox" id="j-is_wifi"> 使用</label>
									</div>
								</div>

								<div id="j-wifi_hold" style="display:none;">
									<div class="control-group">
				                        <label class="control-label">wifi账号</label>
				                        <div class="controls">
				                            <input type="text" id="j-wifi-account">
				                        </div>
				                    </div>
			                    </div>

								<div class="control-group">
									<label class="control-label">是否使用【云打印】</label>
									<div class="controls">
										<label class="checkbox"><input type="checkbox" id="j-is_print"> 使用</label>
									</div>
								</div>

								<div id="j-print_hold" style="display:none;">
									<div class="control-group">
				                        <label class="control-label">终端号</label>
				                        <div class="controls">
				                            <input type="text" id="j-profile-machinecode">
				                        </div>
				                    </div>

	                    			<div class="control-group">
				                        <label class="control-label">密   钥</label>
				                        <div class="controls">
				                            <input type="text" id="j-profile-machinekey">
				                        </div>
				                    </div>
								</div>

								<div class="control-group">
									<label class="control-label">是否启用配送功能</label>
									<div class="controls">
										<label class="checkbox"><input type="checkbox" id="j-is_send"> 启用</label>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">签约模式</label>
									<div class="controls">
										<select id="j-sign-list">
											<option>模式A</option>
											<option>模式B</option>
										</select>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">开发人员</label>
									<div class="controls">
										<input type="text" id="j-developer" />
									</div>
								</div>
							</div>
						</div>

						<div class="widget-box" >
							<div class="widget-title">
								<h5>基本资料</h5>
							</div>
							<div class="widget-content">

								<div class="control-group">
									<label class="control-label">联系电话</label>
									<div class="controls">
										<input type="text" id="j-profile-phone" class="input-medium1" />

										<label class="col2-label">管理人联系电话</label>
										<input type="text" id="j-profile-admin_phone" class="input-medium1" />
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">联系地址</label>
									<div class="controls">
										<input type="text" id="j-profile-address" />
									</div>
								</div>

					            <div class="control-group">
									<label class="control-label">微信公众号</label>
									<div class="controls">
										<input type="text" id="j-profile-wechat_id"  class="input-medium1"/>

										<label class="col2-label">服务QQ号</label>
										<input type="text" id="j-profile-qq"  class="input-medium1"/>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">IOS地址</label>
									<div class="controls">
										<input type="text" id="j-profile-ios" />
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">安卓地址</label>
									<div class="controls">
										<input type="text" id="j-profile-android" />
									</div>
								</div>
							

								<div class="control-group">
									<label class="control-label">其他备注</label>
									<div class="controls">
										<input type="text" id="j-profile-note" />
									</div>
								</div>
							</div>
						</div>

						<div class="widget-box" >
							<div class="widget-title">
								<h5>类别名称</h5>
							</div>
							<div class="widget-content">

								<div class="control-group">
									<label class="control-label">活动咨询</label>
									<div class="controls">
										<input type="text" value="默认名称" class="input-small" />

										<label class="col3-label">商品展示</label>
										<input type="text" value="默认名称" class="input-small" />

										<label class="col3-label">快速预约</label>
										<input type="text" value="默认名称" class="input-small" />
									</div>
								</div>

					            <div class="control-group">
									<label class="control-label">图片墙</label>
									<div class="controls">
										<input type="text" value="默认名称" class="input-small" />

										<label class="col3-label">包厢</label>
										<input type="text" value="默认名称" class="input-small" />
									</div>
								</div>
							</div>
						</div>

						<div class="form-actions">
							<button type="reset" class="btn"><i class="icon-refresh"></i> 清除重置</button>
							<button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> 完成保存</button>
						</div>
					</form>
				</div>
			</div>

			<div id="footer">
				<p>关于淘宝合作伙伴营销中心廉正举报联系客服开放平台诚征英才联系我们网站地图法律声明© 2003-2014 Taobao.com 版权所有</p>
				<p>网络文化经营许可证：文网文[2010]040号|增值电信业务经营许可证：浙B2-20080224-1|信息网络传播视听节目许可证：1109364号 </p>
			</div>
		</div>
		
		<!--公用js-->
        <script src="../public/js/jquery.min.js"></script>
        <script src="../public/js/jquery.ui.custom.js"></script>
        <script src="../public/js/bootstrap.min.js"></script>
        <script src="../public/js/unicorn.js"></script>
        <script src="../public/js/jquery.tmpl.min.js"></script>
        <script src="../public/js/common.js"></script>

        <!--页面js-->

        <script charset="utf-8" src="../public/kindeditor/kindeditor-min.js"></script>
		<script charset="utf-8" src="../public/kindeditor/lang/zh_CN.js"></script>

        <!--分类下拉框模版-->
        <script type="text/jquery-tmpl-x" id="j-tmpl-category-listitem">
        	<option value="0">请选择分类</option>
        	{{each(i, v) list}}
        		<option value="${v.id}" data-cid="${v.cid}">${v.name}</option>
        	{{/each}}
        </script>

        <script type="text/jquery-tmpl-x" id="j-tmpl-template-listitem">
        	{{each(i, v) list}}
        		<option value="${v.id}">${v.name}</option>
        	{{/each}}
        </script>

        <script type="text/javascript">
        	var Shop_Category = [
        		{
        			id : 1,
        			name : "餐饮超市类"
        		},
        		{
        			id : 2,
        			name : "夜场类"
        		},
        		{
        			id : 3,
        			name : "企业类"
        		}
        	];


	        var Shop_SubCategory = [
	    		{
	    			id : 1,
	    			name : "二级分类一",
	    			cid : 1
	    		},
	    		{
	    			id : 2,
	    			name : "二级分类二",
	    			cid : 1
	    		},
	    		{
	    			id : 3,
	    			name : "二级分类三",
	    			cid : 1
	    		},
	    		{
	    			id : 4,
	    			name : "二级分类四",
	    			cid : 1
	    		},
	    		{
	    			id : 5,
	    			name : "二级分类5",
	    			cid : 2
	    		},
	    		{
	    			id : 6,
	    			name : "二级分类6",
	    			cid : 3
	    		},
	    		{
	    			id : 7,
	    			name : "二级分类7",
	    			cid : 3
	    		},
	    		{
	    			id : 8,
	    			name : "二级分类8",
	    			cid : 3
	    		}
	    	];

	    	var Template_List = [
	    		{
	    			id : 1,
	    			name : "模版一",
	    			cid : 1
	    		},
	    		{
	    			id : 2,
	    			name : "模版二",
	    			cid : 2
	    		},
	    		{
	    			id : 3,
	    			name : "模版三",
	    			cid : 2
	    		},
	    		{
	    			id : 4,
	    			name : "模版四",
	    			cid : 3
	    		},
	    		{
	    			id : 5,
	    			name : "模版5",
	    			cid : 1
	    		},
	    		{
	    			id : 6,
	    			name : "模版6",
	    			cid : 2
	    		},
	    		{
	    			id : 7,
	    			name : "模版7",
	    			cid : 2
	    		},
	    		{
	    			id : 8,
	    			name : "模版8",
	    			cid : 3
	    		}
	    	];
        </script>
        <script type="text/javascript">
        	var MPage = {
        		init : function(){
        			var mpage = this;

        			var text_editor,
        				image_editor;
					KindEditor.ready(function(K) {
						//文本编辑器
						mpage.text_editor = text_editor = K.create('textarea[name="content"]', {
							uploadJson : '../public/kindeditor/php/upload_json.php',
							allowFileManager : true
						});

						//图片上传编辑
						mpage.image_editor = image_editor = K.editor({
							uploadJson : '../public/kindeditor/php/upload_json.php',
							fileManagerJson : '../public/kindeditor/php/file_manager_json.php'
						});
						
						//图片上传绑定
						K('#j-btn-imageManager').click(function() {
							image_editor.loadPlugin('filemanager', function() {
								image_editor.plugin.filemanagerDialog({
									viewType : 'VIEW',
									dirName : 'image',
									clickFn : function(url, title) {
										K('#j-img-placehold').attr("src", url);
										image_editor.hideDialog();
									}
								});
							});
						});

						//从资料库选择图片
						K('#j-btn-imageUpload').click(function() {
							image_editor.loadPlugin('image', function() {
								image_editor.plugin.imageDialog({
									showRemote : false,
									imageUrl : K('#j-img-placehold').attr("src"),
									clickFn : function(url, title, width, height, border, align) {
										K('#j-img-placehold').attr("src", url);
										image_editor.hideDialog();
									}
								});
							});
						});

						var route = Route.parse(document.location.href, Route.SEARCH);

						console.log(route.param);

						//解析url中的id
						/\?id=(\d+)/.test(document.location.href);
						var shop_id = RegExp.$1;
						
						if(shop_id){
							//mpage.getDetail(shop_id);
						} else {
							alert("该商户不存在");
							window.history.back();
						}
					});

					//提交表单
					$("#j-goods-addForm").bind("submit", function(){
						var developer = $.trim( $("#j-developer").val() );
						if(!/[0-9A-Za-z]/.test(developer)){
							alert('开发人员格式输入错误');
							return false;
						}
						return false;
					});
					
					//重置表单
					$("#j-goods-addForm").bind("reset", function(){
						
					});

					$("#j-subCategory-list").bind("change", function(){
						var cid = parseInt($(this).find("option:selected").attr("data-cid")) || 0;

						if(cid > 0){
							$("#j-shop-category-hold").show();

							$.each(Shop_Category, function(i, v){
								if(v.id == cid){
									$("#j-shop-category").html(v.name);
									return false;
								}
							});


							var _Template_List = [];

							$.each(Template_List, function(i, v){
								if(v.cid == cid){
									_Template_List.push(v);
								}
							});

							$("#j-template-list").html( $("#j-tmpl-template-listitem").tmpl({
								list : _Template_List
							}) );

							$("#j-template-hold").show();
						} else {
							$("#j-shop-category-hold").hide();
							$("#j-template-hold").hide();

							$("#j-template-list").val(0);
							$("#j-shop-category").html("");
						}

					});

					$("#j-is_wifi").bind("change", function(){
						if($(this).attr("checked")){
							$("#j-wifi_hold").show();
						} else {
							$("#j-wifi_hold").hide();
						}
					});

					$("#j-is_print").bind("change", function(){
						if($(this).attr("checked")){
							$("#j-print_hold").show();
						} else {
							$("#j-print_hold").hide();
						}
					});

					mpage.showSubCategoryList();
					mpage.getDetail();
        		},

        		getDetail : function(){
        			var data = {
        				cid : 1,
        				scid : 1,
        				tid : 5,
        				is_print : true,
        				is_wifi : false
        			}

        			$("#j-subCategory-list").val(data.scid).trigger("change");
        			$("#j-template-list").val(data.tid);

        			if(data.is_print){
        				$("#j-is_print").attr("checked", "checked").trigger("change");
        			}

        			if(data.is_wifi){
        				$("#j-is_wifi").ttr("checked", "checked").trigger("change");
        			}
        		},


        		showSubCategoryList : function (){
    		    	var mpage = this;

					$("#j-subCategory-list").html( $("#j-tmpl-category-listitem").tmpl({
						list : Shop_SubCategory
					}) );
				}
    		}

    		$(function(){
    			MPage.init();
    		});
    		
        </script>
	</body>
</html>
