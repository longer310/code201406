<!DOCTYPE html>
<html lang="en">
	<!-- container-fluid -->
	<head>
		<title>Unicorn Admin</title>
		<meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--公用样式-->
		<link rel="stylesheet" href="../public/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../public/css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" href="../public/css/unicorn.main.css" />
		<link rel="stylesheet" href="../public/css/unicorn.grey.css" />
		<!--页面样式-->
		<link href="../public/kindeditor/themes/default/default.css" type="text/css" rel="stylesheet">
		<link href="../public/css/select2.css" type="text/css" rel="stylesheet">
	</head>
	<body>
		
		
		<div id="header">
			<h1><a href="./dashboard.html">APP 商户管理系统</a></h1>		
		</div>
		
		<div id="hotline" class="muted">服务热线：400-800-8888</div>

		<div id="user-nav" class="navbar navbar-inverse">
			<dl class="user-info">
				<dt class="muted">福建省宁德米克中式餐饮</dt>
				<dd><span class="muted">用户名：</span><b class="text-error">80222222</b></dd>
				<dd><span class="muted">可提现金额：</span><b class="text-error">￥3088.00</b></dd>
			</dl>
            <ul class="nav btn-group">
                <li class="btn btn-inverse"><a title="" href="#"><i class="icon icon-share"></i> <span class="text">提现</span></a></li>
                <li class="btn btn-inverse"><a title="" href="login.html"><i class="icon icon-off"></i> <span class="text">退出登陆</span></a></li>
            </ul>
        </div>
            
		<div id="sidebar">
			<ul>
				<li><a href="index.html"><i class="icon icon-home"></i> <span>首页</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-gift"></i> <span>活动管理</span> <span class="label">2</span></a>
					<ul>
						<li><a href="activity_list.html">活动列表</a></li>
						<li><a href="activity_add.html">新增活动</a></li>
					</ul>
				</li>
				<li class="submenu">
					<a href="#"><i class="icon icon-tint"></i> <span>产品管理</span><span class="label">3</span></a>
					<ul>
						<li><a href="goods_list.html">产品列表</a></li>
						<li><a href="goods_add.html">新增产品</a></li>
						<li><a href="categroy.html">分类管理</a></li>
					</ul>
				</li>
				<li><a href="order.html"><i class="icon icon-shopping-cart"></i> <span>订单管理</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-picture"></i> <span>图片墙管理</span> <span class="label">2</span></a>
					<ul>
						<li><a href="image_list.html">图片墙列表</a></li>
						<li><a href="image_add.html">新增图片墙</a></li>
					</ul>
				</li>
				<li><a href="user.html"><i class="icon icon-user"></i> <span>会员管理</span></a></li>
				<li><a href="comment.html"><i class="icon icon-comment"></i> <span>留言管理</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-tags"></i> <span>电子券管理</span> <span class="label">2</span></a>
					<ul>
						<li><a href="ticket_list.html">电子券列表</a></li>
						<li><a href="ticket_add.html">新增电子券</a></li>
					</ul>
				</li>
				<li class="active open"><a href="ad.html"><i class="icon icon-bullhorn"></i> <span>广告设置</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-hdd"></i> <span>数据库统计</span> <span class="label">4</span></a>
					<ul>
						<li><a href="pv.html">访问量统计</a></li>
						<li><a href="sale.html">销量统计</a></li>
						<li><a href="charge.html">充值量统计</a></li>
						<li><a href="backup.html">数据备份导出</a></li>
					</ul>
				</li>
				<li class="submenu">
					<a href="#"><i class="icon icon-cog"></i> <span>系统设置</span> <span class="label">6</span></a>
					<ul>
						<li><a href="change_pw.html">登录设置</a></li>
						<li><a href="profile.html">资料设置</a></li>
						<li><a href="message.html">推送服务</a></li>
						<li><a href="rule.html">规则设置</a></li>
						<li><a href="resource.html">素材库管理</a></li>
						<li><a href="cash.html">提现管理</a></li>
					</ul>
				</li>
			</ul>
		</div>
		
		<div id="content">
			<div class="widget-box" >
				<div class="widget-title">
					<span class="icon">
						<i class="icon-user"></i>
					</span>
					<h5>广告设置</h5>
				</div>
				<div class="widget-content">

					<div class="widget-box" >
						<div class="widget-title">
							<h5>登录页大图广告</h5>
						</div>
						<div class="widget-content">
							<form action="#" method="get" class="form-horizontal" id="j-ad-addForm" />
								<div class="control-group">
									<label class="control-label">图片 <b class="text-error">*640x1138</b></label>
									<div class="controls">
										
										<a class="btn btn-info j-btn-imageUpload" href="javascript:;"><i class="icon-folder-open icon-white"></i> 本地上传</a>
										<a class="btn btn-success j-btn-imageManager" href="javascript:;"><i class="icon-picture icon-white"></i> 素材库选择</a>
										<span class="help-inline">上传过的图片可以直接从素材库选择</span>
										<div class="clearfix" style="margin-top:10px;">
											<span class="thumbnail pull-left">
												<img src="http://placehold.it/640x1138" width="128" alt="" class="j-img-placehold">
											</span>
										</div>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">图片 <b class="text-error">*640x960</b></label>
									<div class="controls">
										
										<a class="btn btn-info j-btn-imageUpload1" href="javascript:;"><i class="icon-folder-open icon-white"></i> 本地上传</a>
										<a class="btn btn-success j-btn-imageManager1" href="javascript:;"><i class="icon-picture icon-white"></i> 素材库选择</a>
										<span class="help-inline">上传过的图片可以直接从素材库选择</span>
										<div class="clearfix" style="margin-top:10px;">
											<span class="thumbnail pull-left">
												<img src="http://placehold.it/640x960" width="128" alt="" class="j-img-placehold1">
											</span>
										</div>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label">停留时间：</label>
									<div class="controls">
										<input type="text" class="input-small j-ad-delay" /> 秒
									</div>
								</div>

								<div class="form-actions">
									<button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> 完成保存</button>
								</div>
							</form>
						</div>
					</div>

					<div class="widget-box" >
						<div class="widget-title">
							<h5>首页轮播广告</h5>
						</div>
						<div class="widget-content">
							<form action="#" method="get" class="form-horizontal" id="j-homeslide-addForm" />
								
								<div class="control-group">
									<div class="controls">
										<label class="inline">广告个数</label>
										<input type="text" value="2" class="input-small" readonly="readonly" id="j-homeslide-count" /> 个
										<a href="javascript:;" title="增加一个" class="icon icon-plus-sign" id="j-homeslide-add_ad"></a>
										<a href="javascript:;" title="减少一个" class="icon icon-minus-sign" id="j-homeslide-remove_ad"></a>
										<label class="inline" style="margin-left:20px;">停留时间</label>
										<input type="text" class="input-small" id="j-homeslide-delay" value="1" /> 秒
									</div>
								</div>

								<div id="j-homeslide-ad">
									
								</div>

								<div class="form-actions">
									<button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> 完成保存</button>
								</div>
							</form>
						</div>
					</div>

					<div class="widget-box" >
						<div class="widget-title">
							<h5>wifi设备广告</h5>
						</div>
						<div class="widget-content">
							<form action="#" method="get" class="form-horizontal" id="j-wifi-addForm" />
								
								<div class="control-group">
									<div class="controls">
										<label class="inline">广告个数</label>
										<input type="text" value="2" class="input-small" readonly="readonly" id="j-wifi_count" /> 个
										<a href="javascript:;" title="增加一个" class="icon icon-plus-sign" id="j-add_ad"></a>
										<a href="javascript:;" title="减少一个" class="icon icon-minus-sign" id="j-remove_ad"></a>
										<label class="inline" style="margin-left:20px;">停留时间</label>
										<input type="text" class="input-small" id="j-wifi-delay" value="1" /> 秒
									</div>
								</div>

								<div id="j-wifi-ad">
									
								</div>

								<div class="form-actions">
									<button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> 完成保存</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>

			<div id="footer">
				<p>关于淘宝合作伙伴营销中心廉正举报联系客服开放平台诚征英才联系我们网站地图法律声明© 2003-2014 Taobao.com 版权所有</p>
				<p>网络文化经营许可证：文网文[2010]040号|增值电信业务经营许可证：浙B2-20080224-1|信息网络传播视听节目许可证：1109364号 </p>
			</div>
		</div>
		
		<!--公用js-->
        <script src="../public/js/jquery.min.js"></script>
        <script src="../public/js/jquery.ui.custom.js"></script>
        <script src="../public/js/bootstrap.min.js"></script>
        <script src="../public/js/unicorn.js"></script>
        <script src="../public/js/jquery.tmpl.min.js"></script>
        <script src="../public/js/common.js"></script>

        <!--页面js-->
         <script src="../public/js/ue.pager.js"></script>
        <script charset="utf-8" src="../public/kindeditor/kindeditor-min.js"></script>
		<script charset="utf-8" src="../public/kindeditor/lang/zh_CN.js"></script>

		<script type="text/jquery-tmpl-x" id="j-tmpl-wifi-ad-item">
			{{each(i, v) list}}
				<div style="border:1px solid #cdcdcd; background-color:#efefef;position:relative; margin-bottom:10px;" class="j-wifi-ad_item" data-id="${v.id}">
					<div class="control-group">
						<label class="control-label">广告图片</label>
						<div class="controls">
							<div class="clearfix">
								<span class="thumbnail pull-left" style="margin-right:10px;">
									<img src="${v.avatar}" height="128" width="128" alt="" class="j-img-placehold">
								</span>
								<p><a class="btn btn-info j-btn-imageUpload" href="javascript:;"><i class="icon-folder-open icon-white"></i> 本地上传</a></p>
								<p><a class="btn btn-success j-btn-imageManager" href="javascript:;"><i class="icon-picture icon-white"></i> 素材库选择</a></p>
								<span class="help-inline">上传过的图片可以直接从素材库选择</span>
							</div>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">跳转至</label>
						<div class="controls">
							<input class="j-wifi-goto" type="text" value="${v.url}">
						</div>
					</div>

					<a title="删除广告" href="javascript:;" class="j-btn-del btn btn-mini" style="position:absolute; right:10px; top:10px;"><i class="icon-remove"></i> 删除</a>
				</div>
			{{/each}}
		</script>

		<script type="text/jquery-tmpl-x" id="j-tmpl-homeslide-ad-item">
			{{each(i, v) list}}
				<div style="border:1px solid #cdcdcd; background-color:#efefef;position:relative; margin-bottom:10px;" class="j-homeslide-ad-item" data-id="${v.id}">
					<div class="control-group">
						<label class="control-label">广告图片</label>
						<div class="controls">
							<div class="clearfix">
								<span class="thumbnail pull-left" style="margin-right:10px;">
									<img src="${v.avatar}" height="128" width="128" alt="" class="j-img-placehold">
								</span>
								<p><a class="btn btn-info j-btn-imageUpload" href="javascript:;"><i class="icon-folder-open icon-white"></i> 本地上传</a></p>
								<p><a class="btn btn-success j-btn-imageManager" href="javascript:;"><i class="icon-picture icon-white"></i> 素材库选择</a></p>
								<span class="help-inline">上传过的图片可以直接从素材库选择</span>
							</div>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">跳转类型</label>
						<div class="controls">
							<select class="j-homeslide-goto-type">
								<option value="1" {{if v.type ==1 }}selected="selected"{{/if}}>产品</option>
								<option value="2" {{if v.type ==2 }}selected="selected"{{/if}}>活动</option>
								<option value="3" {{if v.type ==3 }}selected="selected"{{/if}}>图片墙</option>
							</select>

							<label class="inline" style="margin-left:20px;">产品ID：</label><input class="input-small j-homeslide-goto-id" type="text" value="${v.goto_id}">
						</div>
					</div>

					<a title="删除广告" href="javascript:;" class="j-btn-del btn btn-mini" style="position:absolute; right:10px; top:10px;"><i class="icon-remove"></i> 删除</a>
				</div>
			{{/each}}
		</script>

		<script>
			var MPage = {
        		init : function(){
        			var mpage = this;

					mpage.initForm();
        		},

        		initForm : function(){
        			var mpage = this;

        			var ad_data = {
						home_slide_ads : {
							delay : 1,
							list : [
								{
									id : 1,
									avatar : "http://placehold.it/128x128",
									goto_id : 3,
									type : 1
								},

								{
									id : 2,
									avatar : "http://placehold.it/128x128",
									goto_id : 3,
									type : 2
								},

								{
									id : 3,
									avatar : "http://placehold.it/128x128",
									goto_id : 3,
									type : 1
								}
							]
						},
						wifi_ads : {
							delay : 1,
							list : [
								{
									id : 1,
									avatar : "http://placehold.it/128x128",
									url : "http://www.baidu.com"
								},

								{
									id : 2,
									avatar : "http://placehold.it/128x128",
									url : "http://www.baidu.com"
								},

								{
									id : 3,
									avatar : "http://placehold.it/128x128",
									url : "http://www.baidu.com"
								}
							]
						}
					}

					console.log(ad_data.wifi_ads);
					mpage.addHomeSlideLevel(ad_data.home_slide_ads);
					$("#j-homeslide-delay").val(ad_data.home_slide_ads.delay);
					$("#j-homeslide-count").val(ad_data.home_slide_ads.list.length);

					console.log(ad_data.wifi_ads);
					mpage.addLevel(ad_data.wifi_ads);
					$("#j-wifi-delay").val(ad_data.wifi_ads.delay);
					$("#j-wifi_count").val(ad_data.wifi_ads.list.length);
					mpage.bindForm();
        		},

        		bindForm : function(){
        			var mpage = this;

        			var image_editor,
        				image_editor1;
					KindEditor.ready(function(K) {
						
						//图片上传编辑
						mpage.image_editor = image_editor = K.editor({
							uploadJson : '../public/kindeditor/php/upload_json.php',
							fileManagerJson : '../public/kindeditor/php/file_manager_json.php'
						});

						//图片上传编辑
						mpage.image_editor1 = image_editor = K.editor({
							uploadJson : '../public/kindeditor/php/upload_json.php',
							fileManagerJson : '../public/kindeditor/php/file_manager_json.php'
						});
						
						//图片上传绑定
						$(document).delegate('.j-btn-imageManager', 'click', function() {
							var $item = $(this).parents(".controls");

							image_editor.loadPlugin('filemanager', function() {
								image_editor.plugin.filemanagerDialog({
									viewType : 'VIEW',
									dirName : 'image',
									clickFn : function(url, title) {
										$item.find('.j-img-placehold').attr("src", url);
										image_editor.hideDialog();
									}
								});
							});
						});

						//从资料库选择图片
						$(document).delegate('.j-btn-imageUpload', 'click', function() {
							var $item = $(this).parents(".controls");

							image_editor.loadPlugin('image', function() {
								image_editor.plugin.imageDialog({
									showRemote : false,
									clickFn : function(url, title, width, height, border, align) {
										$item.find('.j-img-placehold').attr("src", url);
										image_editor.hideDialog();
									}
								});
							});
						});

						//图片上传绑定
						$(document).delegate('.j-btn-imageManager1', 'click', function() {
							var $item = $(this).parents(".controls");

							image_editor1.loadPlugin('filemanager', function() {
								image_editor1.plugin.filemanagerDialog({
									viewType : 'VIEW',
									dirName : 'image',
									clickFn : function(url, title) {
										$item.find('.j-img-placehold1').attr("src", url);
										image_editor1.hideDialog();
									}
								});
							});
						});

						//从资料库选择图片
						$(document).delegate('.j-btn-imageUpload1', 'click', function() {
							var $item = $(this).parents(".controls");

							image_editor1.loadPlugin('image', function() {
								image_editor1.plugin.imageDialog({
									showRemote : false,
									clickFn : function(url, title, width, height, border, align) {
										$item.find('.j-img-placehold1').attr("src", url);
										image_editor1.hideDialog();
									}
								});
							});
						});
					});
					
					/**/
					$("#j-homeslide-add_ad").bind("click", function(){
        				var count = parseInt($("#j-homeslide-count").val()) || 0;
        				
        				count++;
        				$("#j-homeslide-count").val(count);
        				mpage.addHomeSlideLevel({
        					list : [
        						{
        							avatar : "http://placehold.it/128x128"
        						}
        					]
        				});
        			});

        			$("#j-homeslide-remove_ad").bind("click", function(){
        				var count = parseInt($("#j-homeslide-count").val()) || 0;
        				count--;
        				if(count < 0){
        					count = 0;
        				}
        				$("#j-homeslide-count").val(count);
        				mpage.removeHomeSlideLevel();
        			});

        			$("#j-homeslide-ad").delegate(".j-btn-del", "click", function(){
        				var count = parseInt($("#j-homeslide-count").val()) || 0;
        				count--;
        				if(count < 0){
        					count = 0;
        				}
        				$("#j-homeslide-count").val(count);
        				mpage.removeHomeSlideLevel( $(this).parents(".j-homeslide-ad-item").index());
        			});
					/**/

					$("#j-add_ad").bind("click", function(){
        				var count = parseInt($("#j-wifi_count").val()) || 0;
        				
        				count++;
        				$("#j-wifi_count").val(count);
        				mpage.addLevel({
        					list : [
        						{
        							avatar : "http://placehold.it/128x128"
        						}
        					]
        				});
        			});

        			$("#j-remove_ad").bind("click", function(){
        				var count = parseInt($("#j-wifi_count").val()) || 0;
        				count--;
        				if(count < 0){
        					count = 0;
        				}
        				$("#j-wifi_count").val(count);
        				mpage.removeLevel();
        			});

        			$("#j-wifi-ad").delegate(".j-btn-del", "click", function(){
        				var count = parseInt($("#j-wifi_count").val()) || 0;
        				count--;
        				if(count < 0){
        					count = 0;
        				}
        				$("#j-wifi_count").val(count);
        				mpage.removeLevel( $(this).parents(".j-wifi-ad_item").index());
        			});

					//绑定提交表单
					$("#j-ad-addForm").bind("submit", function(){
						
						alert('提交数据');
						return false;
					});
        		},

        		addHomeSlideLevel : function(data){
        			console.log(data);
        			$("#j-homeslide-ad").append( $("#j-tmpl-homeslide-ad-item").tmpl(data) );
        		},

        		removeHomeSlideLevel : function(index){
        			console.log(index);
        			if(typeof index == "number"){
        				$("#j-homeslide-ad .j-homeslide-ad-item").eq(index).remove();
        			} else {
        				$("#j-homeslide-ad .j-homeslide-ad-item").last().remove();
        			}
        			
        		},
        		addLevel : function(data){
        			console.log(data);
        			$("#j-wifi-ad").append( $("#j-tmpl-wifi-ad-item").tmpl(data) );
        		},

        		removeLevel : function(index){
        			if(typeof index == "number"){
        				$("#j-wifi-ad .j-wifi-ad_item").eq(index).remove();
        			} else {
        				$("#j-wifi-ad .j-wifi-ad_item").last().remove();
        			}
        			
        		}
    		}

    		$(function(){
    			MPage.init();
    		});
    		
        </script>
	</body>
</html>
